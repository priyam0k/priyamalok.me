<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribe - Priyam Alok</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;600&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Source Serif 4', serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .link-style { color: #d9534f; text-decoration: none; transition: color 0.2s ease-in-out; }
        .link-style:hover { text-decoration: underline; text-decoration-color: #f0c3c2; text-underline-offset: 2px; }
        .nav-link { font-family: 'Source Sans 3', sans-serif; text-decoration: none; transition: color 0.2s ease-in-out; color: #d9534f; }
        .nav-link:hover { color: #bf4340; }
        h1, .page-title, .post-title { font-family: 'Source Sans 3', sans-serif; font-weight: 600; }
        .tag-checkbox:checked + label { background-color: #f0c3c2; border-color: #d9534f; color: #333; }
        .tag-label { transition: all 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-white flex justify-center">

    <div class="max-w-3xl w-full px-4 sm:px-6 lg:px-8 py-16">
        <!-- Header -->
        <header class="pb-10 mb-10 border-b border-gray-200">
            <div class="flex items-start space-x-4">
                <a href="/"><img src="/logo.jpg" alt="Priyam Alok" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/80x80/e2e8f0/334155?text=PA';"></a>
                <div class="flex-grow">
                    <div class="flex justify-between items-center">
                        <div><a href="/"><img src="/Capturelogo-removebg-preview.png" alt="Priyam Alok Title" class="h-8" onerror="this.onerror=null;this.src='https://placehold.co/200x40/ffffff/1a1a1a?text=Priyam+Alok';"></a></div>
                        <nav class="flex items-center space-x-6 text-base">
                            <a href="/" class="nav-link hidden sm:block text-lg">Home</a>
                            <a href="/project.html" class="nav-link hidden sm:block text-lg">Projects</a>
                            <a href="/blog.html" class="nav-link hidden sm:block text-lg">Musings</a>
                        </nav>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">Musings on insurance tech, finance<br>and life</p>
                </div>
            </div>
            <nav class="flex sm:hidden items-center justify-around space-x-4 text-base pt-6 border-t border-gray-200 mt-6">
                <a href="/" class="nav-link text-lg">Home</a>
                <a href="/project.html" class="nav-link text-lg">Projects</a>
                <a href="/blog.html" class="nav-link text-lg">Musings</a>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="text-base leading-relaxed text-gray-800">
            <section id="subscribe-section" class="mb-12">
                <h1 class="page-title text-3xl mb-4 text-black">Subscribe</h1>
                <p class="mb-8">Get new posts delivered to your inbox. Choose the topics you're interested in.</p>
                <form id="subscribe-form" class="space-y-6">
                    <div class="space-y-4">
                        <input type="email" id="email-input" placeholder="your.email@example.com" required class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#d9534f]">
                        <input type="text" id="name-input" placeholder="Name (optional)" class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#d9534f]">
                    </div>
                    <div>
                        <p class="font-semibold mb-3">Select your interests:</p>
                        <div id="tags-container" class="flex flex-wrap gap-3">
                            <!-- Tags will be dynamically inserted here -->
                        </div>
                    </div>
                    <button type="submit" class="bg-[#d9534f] text-white font-semibold px-8 py-3 rounded-md hover:bg-[#bf4340] transition-colors w-full sm:w-auto">Subscribe</button>
                </form>
            </section>

            <section id="thank-you-section" class="hidden text-center py-16">
                <h2 class="text-2xl font-semibold text-black">Thank you for subscribing!</h2>
                <p class="text-gray-600 mt-2">Please check your inbox to confirm your subscription.</p>
            </section>

            <section id="error-section" class="hidden text-center py-16">
                <h2 class="text-2xl font-semibold text-red-600">Something went wrong</h2>
                <p class="text-gray-600 mt-2">Could not process your subscription. Please check the details and try again.</p>
            </section>
        </main>

        <!-- Footer -->
        <footer class="mt-12 pt-8 border-t border-gray-200 text-base text-gray-600">
            <p>Find me on <a href="https://www.linkedin.com/in/priyamalok/" target="_blank" rel="noopener noreferrer" class="link-style">linkedin</a>, <a href="https://x.com/priyam0k" target="_blank" rel="noopener noreferrer" class="link-style">twitter(x.com)</a></p>
        </footer>
    </div>

    <script src="post.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const tagsContainer = document.getElementById('tags-container');
        const subscribeForm = document.getElementById('subscribe-form');
        const subscribeSection = document.getElementById('subscribe-section');
        const thankYouSection = document.getElementById('thank-you-section');
        const errorSection = document.getElementById('error-section');

        // Dynamically load tags from post.js
        if (typeof posts !== 'undefined' && posts.length > 0) {
            const allTags = [...new Set(posts.flatMap(post => post.tags))].sort();
            allTags.forEach(tag => {
                const tagId = `tag-${tag.replace(/\s+/g, '-')}`;
                
                const wrapper = document.createElement('div');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = tagId;
                checkbox.name = 'tags';
                checkbox.value = tag;
                checkbox.className = 'hidden tag-checkbox';

                const label = document.createElement('label');
                label.htmlFor = tagId;
                label.textContent = tag;
                label.className = 'tag-label cursor-pointer border border-gray-300 rounded-full px-4 py-2 text-sm';

                wrapper.appendChild(checkbox);
                wrapper.appendChild(label);
                tagsContainer.appendChild(wrapper);
            });
        }

        // Handle form submission
        subscribeForm.addEventListener('submit', async function(event) {
            event.preventDefault();

            // --- STEP 1: CONFIGURE YOUR LISTMONK DETAILS ---
            // Replace with the URL from your Listmonk "Public Subscription Page" settings.
            const listmonkApiEndpoint = 'http://localhost:9000/api/public/subscription';
            
            // Map your tag names to the List UUIDs from your Listmonk dashboard.
            // Find the UUID by clicking on a list in Listmonk and copying it.
            const tagToUuidMap = {
                "finance": "UUID_FOR_FINANCE_LIST_HERE",
                "economics": "UUID_FOR_ECONOMICS_LIST_HERE",
                "pricing": "UUID_FOR_PRICING_LIST_HERE",
                "reserving": "UUID_FOR_RESERVING_LIST_HERE",
                "life": "UUID_FOR_LIFE_LIST_HERE",
                "music": "UUID_FOR_MUSIC_LIST_HERE",
                // Add all your other tags and their corresponding UUIDs here
            };
            // --- END OF CONFIGURATION ---


            const name = document.getElementById('name-input').value;
            const email = document.getElementById('email-input').value;
            const selectedTags = Array.from(document.querySelectorAll('input[name="tags"]:checked')).map(el => el.value);

            // Convert selected tag names to their UUIDs
            const listUuids = selectedTags.map(tag => tagToUuidMap[tag]).filter(uuid => uuid && !uuid.includes("UUID_FOR"));

            if (listUuids.length === 0) {
                alert('Please select at least one topic of interest.');
                return;
            }

            const payload = {
                email: email,
                name: name,
                list_uuids: listUuids,
            };

            try {
                const response = await fetch(listmonkApiEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (response.ok) {
                    console.log('Subscription successful:', result);
                    subscribeSection.classList.add('hidden');
                    thankYouSection.classList.remove('hidden');
                } else {
                    console.error('Subscription failed:', result);
                    throw new Error(result.message || 'Subscription failed');
                }
            } catch (error) {
                console.error('Error:', error);
                subscribeSection.classList.add('hidden');
                errorSection.classList.remove('hidden');
            }
        });
    });
    </script>
</body>
</html>

